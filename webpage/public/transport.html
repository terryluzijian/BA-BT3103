<!doctype html>
<!-- Destination Search for NUS Mobility Application-->
<html>

<head>

    <title>NMA - Destination Search</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src='https://api.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.css' rel='stylesheet'/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/font.css">

</head>

<body class="light">

    <nav class="navbar navbar-toggleable navbar-default light" style="z-index: 1">
        <a class="navbar-brand" href="./index.html" id="top-homepage">
            <img class="logo-dark" src="img/Logo%20Dark.png"/>
        </a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon dark">
            </span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#">About</a>
                </li>
                <li class="divider">
                    <svg width="3px" height="3px" viewBox="0 0 3 3" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <!-- Generator: Sketch 47 (45396) - http://www.bohemiancoding.com/sketch -->
                        <desc>Created with Sketch.</desc>
                        <defs></defs>
                        <g id="Search" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Search-Desktop-HD" transform="translate(-1149.000000, -84.000000)" fill="#2B667F">
                                <g id="Upper">
                                    <g id="Navigation---After-Sign-In" transform="translate(80.000000, 37.000000)">
                                        <g id="Menu" transform="translate(822.000000, 31.000000)">
                                            <circle id="Oval" cx="248.5" cy="17.5" r="1.5"></circle>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </li>
                <li class="nav-item">
                    <a class="nav-link on-focus" href="./transport.html">Transport</a>
                </li>
                <li class="divider">
                    <svg width="3px" height="3px" viewBox="0 0 3 3" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <!-- Generator: Sketch 47 (45396) - http://www.bohemiancoding.com/sketch -->
                        <desc>Created with Sketch.</desc>
                        <defs></defs>
                        <g id="Search" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Search-Desktop-HD" transform="translate(-1149.000000, -84.000000)" fill="#2B667F">
                                <g id="Upper">
                                    <g id="Navigation---After-Sign-In" transform="translate(80.000000, 37.000000)">
                                        <g id="Menu" transform="translate(822.000000, 31.000000)">
                                            <circle id="Oval" cx="248.5" cy="17.5" r="1.5"></circle>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./analytics.html">Analytics</a>
                </li>
                <li class="divider">
                    <svg width="3px" height="3px" viewBox="0 0 3 3" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <!-- Generator: Sketch 47 (45396) - http://www.bohemiancoding.com/sketch -->
                        <desc>Created with Sketch.</desc>
                        <defs></defs>
                        <g id="Search" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Search-Desktop-HD" transform="translate(-1149.000000, -84.000000)" fill="#2B667F">
                                <g id="Upper">
                                    <g id="Navigation---After-Sign-In" transform="translate(80.000000, 37.000000)">
                                        <g id="Menu" transform="translate(822.000000, 31.000000)">
                                            <circle id="Oval" cx="248.5" cy="17.5" r="1.5"></circle>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </li>
                <li class="nav-item sign-in icon">
                    <a class="nav-link sign-in" href="./signin.html">
                        <img src="img/Avatar%20Dark.svg"/>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div id='map'></div>
    <h3 id="demo" style="text-align: center; padding: 10px"></h3>

    <footer>
        <a class="navbar-brand" href="#top-homepage" style="width: 20%; padding-bottom: 6px; padding-left: 10px">
            <img class="logo-dark" src="img/Logo%20Dark.png" style="height: 50px; width: 50px" />
        </a>
        <p style="color: #2B667F; font-size: 9px; margin: 6px">&copy; AY17/18 BT3103 Group 10 All Rights Reserved.</p>
        <div class="icon-set" style="padding-bottom: 6px">
            <a class="navbar-brand" href="#">
                <img class="footer-logo" src="img/Instagram.png"/>
            </a>
            <a class="navbar-brand" href="#">
                <img class="footer-logo" src="img/Github.png"/>
            </a>
            <a class="navbar-brand" href="#">
                <img class="footer-logo" src="img/Facebook.png"/>
            </a>
        </div>
    </footer>

    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

    <script>
        var demo = document.getElementById("demo");
        navigator.geolocation.getCurrentPosition(function(location) {
            console.log(location.coords.latitude);
            console.log(location.coords.longitude);
            console.log(location.coords.accuracy);
        });
    </script>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidGVycnlsdXppamlhbiIsImEiOiJjajFpcWJsMHcwMXJ5MndvMHExNTVpcXM3In0.jBC1AkZcA08dnE018DIYrQ';

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v9',
            zoom: 16,
            center: [103.776587, 1.296644],
            maxBounds: [
                [103.766871, 1.289500],
                [103.786345, 1.309276]
            ]
        });
        var nav = new mapboxgl.NavigationControl();
        map.addControl(nav, 'bottom-right');

        map.on('load', function () {

            var url = 'https://carvpx8wn6.execute-api.ap-southeast-1.amazonaws.com/v1/get-all-taxi?lat=1.296644&lon=103.776587';
            $(document).ready(function () {
                $.getJSON(url).then(data => {
                    $.each(data.taxi.results, function(index) {
                        var eachData = data.taxi.results[index];
                        console.log(eachData);
                        map.addLayer({
                            "id": String(eachData.code),
                            "type": "symbol",
                            "source": {
                                "type": "geojson",
                                "data": {
                                    "type": "FeatureCollection",
                                    "features": [{
                                        "type": "Feature",
                                        "geometry": {
                                            "type": "Point",
                                            "coordinates": [eachData.lon, eachData.lat]
                                        },
                                        "properties": {
                                            "title": "",
                                            "icon": "car"
                                        }
                                    }]
                                }
                            },
                            "layout": {
                                "icon-image": "{icon}-15",
                                "text-field": "{title}",
                                "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                                "text-offset": [0, 0.6],
                                "text-anchor": "top"
                            }
                        });
                    });
                });

                var url2 = 'https://carvpx8wn6.execute-api.ap-southeast-1.amazonaws.com/v1/get-all-bikes?lat=1.296644&lon=103.776587';
                $(document).ready(function () {
                    $.getJSON(url2).then(data => {
                        $.each(data.bike.results, function (index) {
                            var eachData = data.bike.results[index];
                            console.log(eachData);
                            map.addLayer({
                                "id": String(eachData.code),
                                "type": "symbol",
                                "source": {
                                    "type": "geojson",
                                    "data": {
                                        "type": "FeatureCollection",
                                        "features": [{
                                            "type": "Feature",
                                            "geometry": {
                                                "type": "Point",
                                                "coordinates": [eachData.lon, eachData.lat]
                                            },
                                            "properties": {
                                                "title": "",
                                                "icon": "bicycle"
                                            }
                                        }]
                                    }
                                },
                                "layout": {
                                    "icon-image": "{icon}-15",
                                    "text-field": "{title}",
                                    "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                                    "text-offset": [0, 0.6],
                                    "text-anchor": "top"
                                }
                            });
                        });
                    });
                });

                var url3 = 'https://carvpx8wn6.execute-api.ap-southeast-1.amazonaws.com/v1/get-all-buses?lat=1.296644&lon=103.776587';
                $(document).ready(function () {
                    $.getJSON(url3).then(data => {
                        $.each(data.bus.results, function (index) {
                            var eachData = data.bus.results[index];
                            console.log(eachData);
                            map.addLayer({
                                "id": String(eachData.code),
                                "type": "symbol",
                                "source": {
                                    "type": "geojson",
                                    "data": {
                                        "type": "FeatureCollection",
                                        "features": [{
                                            "type": "Feature",
                                            "geometry": {
                                                "type": "Point",
                                                "coordinates": [eachData.lon, eachData.lat]
                                            },
                                            "properties": {
                                                "title": "",
                                                "icon": "bus"
                                            }
                                        }]
                                    }
                                },
                                "layout": {
                                    "icon-image": "{icon}-15",
                                    "text-field": "{title}",
                                    "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                                    "text-offset": [0, 0.6],
                                    "text-anchor": "top"
                                }
                            });
                        });
                    });
                });

            });

        });

    </script>

    <script src="js/aws-cognito-sdk.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/cognito-auth.js"></script>

</body>
</html>
